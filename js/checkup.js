(async () => {
  const response = await fetch("/stream_commands");

  if (!response.ok) {
    throw Error(response.status);
  }

  for (const reader = response.body.getReader();;) {
    const {value, done} = await reader.read();

    if (done) {
      break;
    }
  console.log("text:",value);
  try{
    json=JSON.parse(new TextDecoder().decode(value));
    //refreshServicesStatus(json)
    console.log(JSON.stringify(json));
    td_element=$('tr#'+json.controller_id+' td[data-value='+json.value+'] span')
    td_element.removeClass("label-error")
    td_element.addClass("label-success")
    console.log("id",json.controller_id,"val",json.value)
  }
  catch(error){
    console.error(error)
  }
  //console.log(new TextDecoder().decode(value));
  //$('#stream').html(new TextDecoder().decode(value));
  }
})();
$(document).ready(function () {

$("select").change(function (event) {
  element=$(this).children("option:selected")
  controller_id=element.data('controller_id')
   value=element.val()
if(value != 'none'){
  $(this).val('none')
  $.post("/send_command",
   {
      controller_id: controller_id,
      value:value
   },
   function (data, status) {
     //$("#logs_content").prepend('Timer paused <br>')
     console.log("Command sent.")
     //$("#logs_content").append("Command sent - "+controller_id+" : "+action_text+"</br>");
   });
}
 });
});
/*

{
    "0": 123,
    "1": 34,
    "2": 99,
    "3": 111,
    "4": 110,
    "5": 116,
    "6": 114,
    "7": 111,
    "8": 108,
    "9": 108,
    "10": 101,
    "11": 114,
    "12": 95,
    "13": 105,
    "14": 100,
    "15": 34,
    "16": 58,
    "17": 34,
    "18": 114,
    "19": 102,
    "20": 105,
    "21": 100,
    "22": 95,
    "23": 48,
    "24": 34,
    "25": 44,
    "26": 34,
    "27": 118,
    "28": 97,
    "29": 108,
    "30": 117,
    "31": 101,
    "32": 34,
    "33": 58,
    "34": 50,
    "35": 125,
    "36": 123,
    "37": 34,
    "38": 99,
    "39": 111,
    "40": 110,
    "41": 116,
    "42": 114,
    "43": 111,
    "44": 108,
    "45": 108,
    "46": 101,
    "47": 114,
    "48": 95,
    "49": 105,
    "50": 100,
    "51": 34,
    "52": 58,
    "53": 34,
    "54": 114,
    "55": 102,
    "56": 105,
    "57": 100,
    "58": 95,
    "59": 49,
    "60": 34,
    "61": 44,
    "62": 34,
    "63": 118,
    "64": 97,
    "65": 108,
    "66": 117,
    "67": 101,
    "68": 34,
    "69": 58,
    "70": 50,
    "71": 125,
    "72": 123,
    "73": 34,
    "74": 99,
    "75": 111,
    "76": 110,
    "77": 116,
    "78": 114,
    "79": 111,
    "80": 108,
    "81": 108,
    "82": 101,
    "83": 114,
    "84": 95,
    "85": 105,
    "86": 100,
    "87": 34,
    "88": 58,
    "89": 34,
    "90": 114,
    "91": 102,
    "92": 105,
    "93": 100,
    "94": 95,
    "95": 50,
    "96": 34,
    "97": 44,
    "98": 34,
    "99": 118,
    "100": 97,
    "101": 108,
    "102": 117,
    "103": 101,
    "104": 34,
    "105": 58,
    "106": 50,
    "107": 125,
    "108": 123,
    "109": 34,
    "110": 99,
    "111": 111,
    "112": 110,
    "113": 116,
    "114": 114,
    "115": 111,
    "116": 108,
    "117": 108,
    "118": 101,
    "119": 114,
    "120": 95,
    "121": 105,
    "122": 100,
    "123": 34,
    "124": 58,
    "125": 34,
    "126": 114,
    "127": 102,
    "128": 105,
    "129": 100,
    "130": 95,
    "131": 53,
    "132": 34,
    "133": 44,
    "134": 34,
    "135": 118,
    "136": 97,
    "137": 108,
    "138": 117,
    "139": 101,
    "140": 34,
    "141": 58,
    "142": 50,
    "143": 125,
    "144": 123,
    "145": 34,
    "146": 99,
    "147": 111,
    "148": 110,
    "149": 116,
    "150": 114,
    "151": 111,
    "152": 108,
    "153": 108,
    "154": 101,
    "155": 114,
    "156": 95,
    "157": 105,
    "158": 100,
    "159": 34,
    "160": 58,
    "161": 34,
    "162": 114,
    "163": 102,
    "164": 105,
    "165": 100,
    "166": 95,
    "167": 52,
    "168": 34,
    "169": 44,
    "170": 34,
    "171": 118,
    "172": 97,
    "173": 108,
    "174": 117,
    "175": 101,
    "176": 34,
    "177": 58,
    "178": 50,
    "179": 125,
    "180": 123,
    "181": 34,
    "182": 99,
    "183": 111,
    "184": 110,
    "185": 116,
    "186": 114,
    "187": 111,
    "188": 108,
    "189": 108,
    "190": 101,
    "191": 114,
    "192": 95,
    "193": 105,
    "194": 100,
    "195": 34,
    "196": 58,
    "197": 34,
    "198": 114,
    "199": 102,
    "200": 105,
    "201": 100,
    "202": 95,
    "203": 51,
    "204": 34,
    "205": 44,
    "206": 34,
    "207": 118,
    "208": 97,
    "209": 108,
    "210": 117,
    "211": 101,
    "212": 34,
    "213": 58,
    "214": 50,
    "215": 125
}
*/
